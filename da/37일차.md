https://rt.molit.go.kr/

- 정부에서 지원하는 데이터<br>
https://www.data.go.kr/

<br>
# Colab에서 한글 폰트 사용하기

## Step 1. Colab 가상머신에 한글 폰트 설치

```python
# Colab Jupyter Notebook에서 리눅스 명령어를 실행
# 한번만 실행하면 됨

!sudo apt-get install -y fonts-nanum    # sudo -> 관리자 권한으로. apt-get -> 프로그램 삭제, 설치. -y -> 전부 yes로 대답하겠다. fonts-nanum -> 나눔 폰트 설치
!sudo fc-cache -fv
!rm ~/.cache/matplotlib -rf    # rm -> remove 삭제. .cache에서 matplotlib이라는 파일 삭제
```
![image](https://github.com/user-attachments/assets/aef9c717-046a-44a5-a937-ec277b999331)

## Step 2. Colab Runtime 재시작(Ctrl + M)

- 런타임 -> 세션 다시 시작

## Step 3. matplotlib.pyplot 모듈에서 한글 폰트를 사용할 수 있도록 설정

```python
import matplotlib.pyplot as plt

# matplotlib.pyplot 모듈에서 사용할 폰트 패밀리 한글로 설정
plt.rc('font', family = 'NanumBarunGothic')
# 그래프에 표시되는 모든 텍스트(제목, 축 이름, 범례 등)에 나눔바른고딕 폰트를 사용하도록 지정(한글 텍스트가 깨지지 않도록)
```

## 한글 폰트 테스트

```python
import numpy as np
import pandas as pd
import seaborn as sns
```

```python
df = pd.DataFrame(data = {
    '구': ['서초구', '강남구', '송파구'],
    '가격': [9_000, 10_000, 8_500]
})
```
```python
df
```
![image](https://github.com/user-attachments/assets/7be0b44b-f5c2-4362-b084-6bb6cc6e2ccd)

```python
plt.barplot(x = df['구'], height = df['가격'])
plt.xlabel('지역')
plt.ylabel('가격')
plt.show()
```
![image](https://github.com/user-attachments/assets/1ef4701f-7827-48c5-94bf-dba29c4ab9b7)

# 아파트 실거래가 데이터 분석

*   [apt_202504.csv](https://github.com/JakeOh/202505_BD50/raw/refs/heads/main/datasets/apt_202504.csv) 파일을 읽고 DataFrame 생성
    * 첫 15줄은 파일 설명 문서 -> skip
    * encoding 파라미터 설정(한글 인코딩: euc-kr)
    * '가격' 컬럼에는 숫자 자릿수를 구분하는 comma가 사용되고 있음(예: 10,000)
        * '가격' 컬럼은 숫자 타입이어야 함!
*   데이터 프레임 파악
    * info, head, tail, describe, dtypes, ...
*   '시군구' 컬럼의 값을 이용해서, province 파생 변수(광역시도)를 만듦.
    * '인천광역시 부평구 부평동' -> '인천광역시'
    * '충청남도 천안시 서북구' -> '충청남도'
*   '시군구' 컬럼의 값을 이용해서, county 파생 변수(시/군/구)를 만듦.
    * '인천광역시 부평구 부평동' -> '부평구'
    * '충청남도 천안시 서북구' -> '천안시'
*   '계약년월' 컬럼의 값을 이용해서, year(계약년도), month(계약월) 파생 변수 만듦.
    * 202504 -> 2025(year), 4(month)
*   서울특별시 아파트들의 구별 아파트 가격의 개수, 평균, 최솟값, 최댓값
*   도/광역시별 아파트 가격 개수, 평균, 최솟값, 최댓값
면적이 $84 m^2$ 이상 $100 m^2$ 미만의 서울특별시 아파트들 중에서, 구별 아파트 가격 개수, 평균, 최솟값, 최댓값
*   면적이 $84 m^2$ 이상 $100 m^2$ 미만의 아파트들 중에서, 도/광역시별 아파트 가격 개수, 평균, 최솟값, 최댓값 
    * 결과를 평균의 내림차순으로 정렬해서 출력 
    * 결과를 최댓값의 내림차순으로 정렬해서 출력 
    * 결과를 최솟값의 오름차순으로 정렬해서 출력

## 데이터프레임 생성

```python
apt_file = 'https://github.com/JakeOh/202505_BD50/raw/refs/heads/main/datasets/apt_202504.csv'
```
```python
apt_t = pd.read_csv(apt_file,
                    encoding = 'euc-kr',    # encoding: 파일 인코딩(컴퓨터가 처리할 수 있는 형태인 숫자로 변환) 타입 설정
                    skiprows = 15,          # skiprows: 파일에서 몇 줄을 생략할 지를 설정.(16번째 줄부터 데이터를 읽음)
                    thousands = ',',        # thousands: 숫자에서 천자리 구분자로 사용된 문자.(','로 사용했을 경우 이를 숫자로 인식하게 해줌)
                    na_values = '-'         # na_balues: NA(null)로 취급할 문자열.('-'로 표시된 경우 NaN으로 처리함. 즉, 데이터가 없다는 의미로 인식함)
                    parse_dates = ['해제사유발생일', '등기일자']    # 자동으로 날짜 타입으로 바꿔주는 기능
)        
```
```python
apt_t.info()    # 동, 등기일자는 숫자 아니면 '-'라서 타입이 object임
```
![image](https://github.com/user-attachments/assets/9ea42476-1a54-4071-a2b9-07d942ae901d)

## 데이터 탐색

```python
apt_t.describe()
```
![image](https://github.com/user-attachments/assets/a2ef7538-2081-4fe0-8d9f-2e80e9e94a6c)

```python
apt_t['해제사유발생일'].unique()
```
![image](https://github.com/user-attachments/assets/994511b2-e7bc-4c9c-b68a-d27e4767eb35)

```python
apt_t['해제사유발생일'].unique()    # 포맷 안해도 정상적으로 보여줌
```
![image](https://github.com/user-attachments/assets/c0088a98-beda-41f1-b985-a46bee34d048)

```python
apt_t['등기일자'].unique()  # 이건 좀 이상하게 보여줌
```
![image](https://github.com/user-attachments/assets/de5ee761-8016-4d4e-8c6c-d88fc70ab954)

```python
apt_t = pd.read_csv(apt_file, 
                    encoding = 'euc-kr',
                    skiprows = 15,
                    na_values = '-',
                    thousands=',',
                    parse_dates=['해제사유발생일', '등기일자'],
                    date_format = {'해제사유발생일': '%Y%m%d', '등기일자': '%y.%m.%d'}) # Y는 년도 4자리, y는 년도 2자리
# parse_dates 파라미터: 날짜 포맷으로 해석(parse)할 컬럼(들)의 리스트.
# date_format 파라미터: {'컬럼이름': '날짜포맷', ...}
```
```python
apt_t['해제사유발생일'].unique()
```
![image](https://github.com/user-attachments/assets/229b2952-dd71-42b8-aec2-43cf566cafe8)

```python
apt_t['등기일자'].unique()
```
![image](https://github.com/user-attachments/assets/55a1614b-db0d-40a9-b8fd-c47ff5df7261)

```python
apt_t.info()
```
![image](https://github.com/user-attachments/assets/5052fdbf-56bf-4753-8764-5cf3f7d3dbba)

```python
# pd.DataFrame.rename(index = {'old row label': 'new row label', ...}): 인덱스 이름 바꾸기
# pd.DataFrame.rename(columns = {'old column name': 'new column name', ...}): 컬럼 이름 바꾸기
apt_t.rename(columns = {'전용면적(㎡)': '전용면적'}, inplace = True)  # inplace = True -> 원본 데이터프레임에 직접 적용 
```
```python
apt_t.head()
```
![image](https://github.com/user-attachments/assets/104837b3-f36b-4749-adb2-7d543f922d6e)

```python
apt_t.describe()
```
![image](https://github.com/user-attachments/assets/5c47f2a6-bc1f-41ee-9a3b-fd93d000d052)

```python
# 거래 금액 최솟값, 최댓값인 행
apt_t[(apt_t['거래금액(만원)'] == apt_t['거래금액(만원)'].min()) |
       (apt_t['거래금액(만원)'] == apt_t['거래금액(만원)'].max())]
```
![image](https://github.com/user-attachments/assets/1cdc6a2a-7348-4ff1-9cad-a173b582502f)

```python
# 전용면적 히스토그램
sns.hisplot(data = apt_t, x = '전용면적', bins = 15)
plt.show()
```
![image](https://github.com/user-attachments/assets/27900e32-43c3-426b-add1-c2fb7a02ad23)

```python
# 전용면적 box plot
sns.boxplot(data = apt_t, x = '전용면적')
plt.show()
```
![image](https://github.com/user-attachments/assets/39a36fad-5c10-4c37-bd88-d3098bf25c21)

```python
# 거래금액
fig, axes = plt.subplots(nrows = 2, figsize = (4, 8))

sns.boxplot(data = apt_t, x = '거래금액(만원)', ax = axes[0])
sns.histplot(data = apt_t, x = '거래금액(만원)', ax = axes[1])

plt.show()
```
![image](https://github.com/user-attachments/assets/a7de3d64-4ff8-4dde-8108-97d967309e6e)

# 파생변수 추가

```python
apt_t['province'] = apt_t['시군구'].str.split().str[0]
apt_t['county'] = apt_t['시군구'].str.split().str[1]
```
```python
apt_t.head()
```
![image](https://github.com/user-attachments/assets/f1288070-d734-4a44-997e-a5aa52e5b2b8)

```python
apt_t.province.unique()
```
![image](https://github.com/user-attachments/assets/abafc734-333f-4f68-9b5d-bfee89aa6d9a)

```python
apt_t.county.unique()
```
![image](https://github.com/user-attachments/assets/c0329d47-a10b-4cda-8df1-ec6beddabc02)

```python
apt_t['year'] = apt_t['계약년월'] // 100
apt_t['month'] = apt_t['계약년월'] % 100
```

# 서울 아파트 실거래가 분석
```python
seoul_df = apt_t[apt_t.province == '서울특별시']
seoul_df.head()
```
![image](https://github.com/user-attachments/assets/7d2727eb-61ae-4fe9-bef6-323321b41f85)

```python
seoul_df.info()
```
![image](https://github.com/user-attachments/assets/ec83e646-9a27-415e-8d85-acc154754c53)

## 서울 구별 거래 건수, 거래 금액 평균, 최댓값, 최솟값
```python
seoul_df.groupby(by = ['county'])['거래금액(만원)'].agg(['count', 'mean', 'max', 'min'])
```
![image](https://github.com/user-attachments/assets/ddb3843a-e4aa-40bf-94b5-4f61e5d27815)

```python
seoul_by_county = seoul_df.pivot_table(values = '거래금액(만원)',
                                        index = 'county',
                                        aggfunc = ['count', 'mean', 'max', 'min']
seoul_by_county
```
![image](https://github.com/user-attachments/assets/2aa49529-a82e-4da8-beec-697f0b31779b)

```python
# seoul_by_county.sort_values(by = 'count')   # 멀티 인덱스라서 안됨. groupby는 가능
```

```python
# seoul_by_county.sort_values(by = ('count', '거래금액(만원)'), ascending = False)   # 멀티 인덱스라서 안됨. groupby는 가능
```
![image](https://github.com/user-attachments/assets/6defb324-45eb-46e2-8eca-411de371156b)

```python
seoul_by_county = seoul_df.pivot_table(values = '거래금액(만원)',
                                        index = 'county',
                                        aggfunc = {'거래금액(만원)':['count', 'mean', 'max', 'min']})
seoul_by_county
```
![image](https://github.com/user-attachments/assets/828a3e67-2048-40ae-a405-c4a16a4739d9)

```python
# 서울 아파트 거래 건수가 많은 상위 10개 지역
seoul_top10 = seoul_by_county.sort_values(by = 'count', ascending = False).head(n = 10)
sns.barplot(data = seoul_top10, x = 'count', y = 'county')
plt.show()
```
![image](https://github.com/user-attachments/assets/1446c6a3-c32c-43fd-806f-33b5aea1f492)

```python
# 아파트 거래금액 평균 상위 10개
seoul_top10 = seoul_by_county.sort_values(by = 'mean', ascending = False).head(n = 10)
sns.barplot(data = seoul_top10, x = 'mean', y = 'county')
plt.show()
```
![image](https://github.com/user-attachments/assets/ac5c83c7-af85-4d03-82b3-6b5e3a885ddf)

```python
fig = plt.figure(figsize = (20, 4))
sns.boxplot(data = seoul_df, x = 'county', y = '거래금액(만원)')
plt.show()

# 박스 크기가 작은건 아파트 가격 편차가 크지 않다는거
```
![image](https://github.com/user-attachments/assets/5d7ee7a4-21b4-4377-9757-f1876c1e1587)

## 전용면적 $84 m^2$ 이상 $100 m^2$ 미만인 서울 아파트 거래금액 분석

```python
seoul_mid_size_df = seoul_df[(seoul_df['전용면적'] >= 84) &
                                (seoul_df['전용면적'] < 100)]
seoul_mid_size_df
```
![image](https://github.com/user-attachments/assets/912f1d13-5893-4bad-bba4-27f2438b1a09)

```python
seoul_mid_size_by_county = seoul_mid_size_df.pivot_table(values = '거래금액(만원)',
                                                        index = 'county',
                                                        aggfunc = {'거래금액(만원)': ['count', 'mean', 'max', 'min']})
seoul_mid_size_by_county
```
![image](https://github.com/user-attachments/assets/040d6214-9054-4832-8e1b-853812812707)

```python
# 거래 건수 상위 10개 지역
seoul_top10 = seoul_mid_size_by_county.sort_values(by = 'count', ascending = False).head(n = 10)
sns.barplot(data = seoul_top10, x = 'count', y = 'county')
plt.show()
```
![image](https://github.com/user-attachments/assets/ffcd2681-827e-4285-9e6d-729f6f3b4df5)

```python
# 거래 금액 상위 10개
seoul_top10 = seoul_mid_size_by_county.sort_values(by = 'mean')
```

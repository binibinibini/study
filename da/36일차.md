# movielens 데이터 분석

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
```

# 데이터 준비
```python
# 데이터 파일들의 경로
movies_file = 'https://github.com/wesm/pydata-book/raw/refs/heads/3rd-edition/datasets/movielens/movies.dat'
ratings_file = 'https://github.com/wesm/pydata-book/raw/refs/heads/3rd-edition/datasets/movielens/ratings.dat'
users_file = 'https://github.com/wesm/pydata-book/raw/refs/heads/3rd-edition/datasets/movielens/users.dat'
```

```python
# 데이터프레임 컬럼 이름
movies_col = ['movie_id', 'title', 'genres']
ratings_col = ['user_id', 'movie_id', 'rating', 'timestamp']
users_col = ['user_id', 'gender', 'age', 'occupation', 'zip_code']
```

## movies 데이터프레임

```python
movies = pd.read_csv(movies_file, sep = '::', engine = 'python', names = movies_col_
movies.head()
```
![image](https://github.com/user-attachments/assets/f4c3ccb0-24cf-4739-bd44-d2fd2a004ff5)

```python
movies.info()
```
![image](https://github.com/user-attachments/assets/b1769916-c06b-4995-8e87-6844fb63c26c)

## ratings 데이터프레임
```python
ratings = pd.read_csv(ratings_file, sep = '::', engine = 'python', names = ratings_col)
ratings.head()
```
![image](https://github.com/user-attachments/assets/6015c55e-b850-44dc-bb4e-4a6db8f5306a)

```python
ratings.info()
```
![image](https://github.com/user-attachments/assets/59f8833b-710b-43a1-bb76-581d9a5bdc04)

## users 데이터프레임

```python
users = pd.read_csv(users_file, sep = '::', engine = 'python', names = users_col)
users.head()
```
![image](https://github.com/user-attachments/assets/9e18de44-3352-4126-ae0a-97d208ae6dc7)

```python
users.info()
```
![image](https://github.com/user-attachments/assets/e7ff57a6-9d16-4fa2-b445-8b33be44b8eb)

# 데이터프레임 합치기(merge/join)

## ratings와 movies를 merge

```python
# movie_id 컬럼을 사용한 inner join
df = pd.merge(ratings, movies)  # 이름이 같으니깐 on = 'movie_id' 생략 가능
```
```python
df.head()
```
![image](https://github.com/user-attachments/assets/8119aa25-6e53-4b60-a7f4-579b43567841)

```python
df.info()
```
![image](https://github.com/user-attachments/assets/17cf0b2c-f421-46f8-aaf0-a8c7bfe44ad3)

## df와 users를 merge

```python
# user_id 컬럼을 사용한 inner join
df = pd.merge(df, users)
```
```python
df.head()
```
![image](https://github.com/user-attachments/assets/ebd52cb4-60b1-4cbc-a406-1fdbce072934)

```python
df.info()
```
![image](https://github.com/user-attachments/assets/7ca62831-2cb2-4f35-839e-d2977f944404)

# 데이터 탐색<br>

* 성별 빈도수
* 연령대 빈도수
* 직업군 빈도수
* 별점 빈도수

## 성별 분석

```python
df.gender.value_counts()
```
![image](https://github.com/user-attachments/assets/d8f35c16-e1cc-4e00-aefe-01b32fc2febd)

```python
sns.countplot(data = df, x = 'gender')
plt.show()
```
![image](https://github.com/user-attachments/assets/e5d9818e-d840-4bdd-a7dd-736772b30b57)

## 연령대 분석

```python
df.age.value_counts()
```
![image](https://github.com/user-attachments/assets/8ba708b3-cadd-40a7-8d6c-06900e7e5ff6)

```python
sns.countplot(data = df, x = 'age')
plt.show()
```
![image](https://github.com/user-attachments/assets/f2dae97c-3185-45ca-8127-8a25ee20aef1)

## 직업군 분석

```python
df.occupation.value_counts()
```
![image](https://github.com/user-attachments/assets/86ce5b32-eee7-47f0-94a7-73cc4395988d)

```python
sns.countplot(data = df, x = 'occupation')
plt.show()
```
![image](https://github.com/user-attachments/assets/7becdc93-cf42-4df9-94d4-01b12d707eab)

```python
df.rating.value_counts()
```
![image](https://github.com/user-attachments/assets/8a75e48e-3301-4f8d-83da-c63f33009a44)

```python
sns.countplot(data = df, x = 'rating')
plt.show()
```
![image](https://github.com/user-attachments/assets/b3b38c91-4e69-489c-8d61-391e2d691a20)

```python
df.rating.describe()
```
![image](https://github.com/user-attachments/assets/6e655cba-8cab-409b-99f3-693a61da2639)

```python
sns.boxplot(data = df, y = 'rating')
plt.show()
```
![image](https://github.com/user-attachments/assets/c517a3e1-9ed7-42da-ae8b-88ed623d4901)

```python
sns.boxplot(data = df, x = 'gender', y = 'rating')
plt.show()
```
![image](https://github.com/user-attachments/assets/3e10cf03-9b29-4313-b457-b6e08185190a)

# 데이터 분석

## 별점 평균 상위 10개, 하위 10개 영화 제목

```python
by_title = df.groupby(by = ['title']).rating.mean()
by_title.head(n = 10)
```
![image](https://github.com/user-attachments/assets/37502cf6-52be-4634-b1a1-7400a9f29d96)

```python
by_title_sorted = by_title.sort_values(ascending = False)
by_title_sorted.head(n = 10)
```
![image](https://github.com/user-attachments/assets/94fa8c3b-8da4-40fe-a5d4-d898e1b25d59)

```python
df[df.title = 'Lured (1947)']
```
![image](https://github.com/user-attachments/assets/e7adc4c4-3017-43f7-bad6-84efab6ee82b)

```python
by_title_sorted.tail(n = 10)
```
![image](https://github.com/user-attachments/assets/fc441771-98d7-4d2b-8936-8c55af2010c1)

```python
df[df.title = 'Wirey Spindell (1999)']
```
![image](https://github.com/user-attachments/assets/3a77f6ff-2d5d-4cfb-9e49-391153d8e4d5)

* 별점 리뷰 건수가 1~2개 밖에 없는 영화들의 별점 평균은 큰 의미가 없음.
* 일정 개수 이상의 별점 리뷰가 있는 영화들을 선택해서 별점 평균을 분석하는 것이 의미가 있음.

```python
title_count = df.title.value_counts()
title_count
```
![image](https://github.com/user-attachments/assets/26a4e29c-4c97-4ebb-9d27-bfb38b087d44)

```python
title_count.describe()
```
![image](https://github.com/user-attachments/assets/897f6b50-404b-4fe2-ad80-d22633cfb661)

## 별점 리뷰 횟수가 120회 이상인 영화들 선택

```python
# 120번 이상 별점 리뷰를 받은 영화 제목들.
indexer = title_count[title_count >= 120].index
indexer
```
![image](https://github.com/user-attachments/assets/054c4c34-f648-407f-aab4-aa64643c5768)

```python
# 별점 리뷰 횟수가 120번 이상인 영화들의 별점 평균
by_title.loc[indexer]
```
![image](https://github.com/user-attachments/assets/845ce5dc-a10c-4ac2-916e-11e01cde7ff6)

```python
# 별점 리뷰 횟수가 120번 이상인 영화들의 별점 평균 내림차순 정렬.
by_title_sorted = by_title.loc[indexer].sort_values(ascending = False)
```
```python
by_title_sorted.head(n = 10)
```
![image](https://github.com/user-attachments/assets/0d3c5e49-0abf-40bd-90cc-6ab9c6a0a076)

```python
#  별점 평균 하위 10개 영화
by_title_sorted.tail(n = 10)
```
![image](https://github.com/user-attachments/assets/a9dbe298-b3e6-491c-8b81-15d88c29ee80)

## 성별에 따른 영화 선호도

* 별점 리뷰 횟수 120번 이상인 영화들 중에서.
* 성별에 따른 별점 평균, 성별 상위 10개, 하위 10개 영화 제목

```python
df_reduced = df[df.title.isin(indexer)]
df_reduced
```
![image](https://github.com/user-attachments/assets/984cc381-78ef-4f9e-97a4-cb4a2f6836f9)

```python
by_title_gender = df_reduced.groupby(by = ['sex', 'title']).rating.mean()
by_title_gender  # MultiIndex를 갖는 Series
```
![image](https://github.com/user-attachments/assets/aefff37e-6203-4914-96ed-757c79de089b)

```python
by_title_gender = by_title_gender.unstack()  # 가장 마지막 레벨의 인덱스 --> 컬럼
by_title_gender
```

```python
by_title_gender = df_reduced.pivot_table(value = 'rating', index = 'title', columns = 'gender')
by_title_gender
```
![image](https://github.com/user-attachments/assets/84549bc0-81ca-46ca-8667-5060befd42de)

### 여성 별점 평균 상/하위 10개 영화 제목

```python
by_title_gender.sort_values(by = 'F', ascending = False).tail(n = 10)
```
![image](https://github.com/user-attachments/assets/6d9652b1-e856-436c-bbc4-62ffdc6a735c)

```python
by_title_gender.sort_values(by = 'F', ascending=False).head(n = 10)
```
![image](https://github.com/user-attachments/assets/862b6b84-005b-4f04-b97c-67661c52bb77)

### 성별 별점 평균의 차이가 큰 영화

```python
by_title_gender
```
![image](https://github.com/user-attachments/assets/37ab31c2-cec9-46fd-bb74-7466f1063c22)

```python
# 파생 변수: 여성 별점 평균 - 남성 별점 평균
by_title_gender['diff'] = by_title_gender.F - by_title_gender.M
by_title_gender
```
![image](https://github.com/user-attachments/assets/5b12e3ca-1507-4a99-bc51-f1b65e5b6c39)

```python
by_title_gender.sort_values(by = 'diff', ascending = False).head(n = 10)
```
![image](https://github.com/user-attachments/assets/0a2e53ec-d2c9-4b82-88bc-e075e95ceb92)

```python
by_title_gender.sort_values(by = 'diff', ascending = False).tail(n = 10)
```
![image](https://github.com/user-attachments/assets/beb8cc51-b556-4c4c-9c0e-20abd027e2c4)

## 영화 장르 분석

* 여성 별점 평균 상위 100개 영화들의 장르
* 남성 별점 평균 상위 100개 영화들의 장르.

```python
female_top100 = by_title_gender.sort_values(by = 'F', ascending = False).head(n = 100).index
female_top100
```
![image](https://github.com/user-attachments/assets/b4fc7bee-680b-4c44-b1e0-ccfba434cddb)

```python
female_top100_movies = movies[movies.title.isin(female_top100)]
female_top100_movies
```
![image](https://github.com/user-attachments/assets/cd326673-168e-4b03-808f-ea202b745d95)

```python
female_top100_genres = []

for x in female_top100_movies.genres:
    female_top100_genres.extend(x.split(sep = '|'))

female_top100_genres = pd.Series(female_top100_genres)  # list -> Series 변환
female_genres = female_top100_genres.value_count()
female_genres
```
![image](https://github.com/user-attachments/assets/7062a935-c5ef-4e24-9504-f821e8784c12)

```python
female_genres_10 = female_genres.head(n = 10)
```
```python
sns.barplot(x = female_genres_10, y = female_genres_10.index)
plt.show()
```
![image](https://github.com/user-attachments/assets/a3743184-48e9-44d5-bbce-702ae6134df1)

```python
movies['genre'] = movies.genres.str.split('|')
movies['genre']
```
![image](https://github.com/user-attachments/assets/9983f9e0-4745-446f-9616-e59d5e0625e8)

```python
movies.pop('genres')
# pd.DataFrame.pop() 메서드: 데이터프레임에서 컬럼을 삭제하고, 삭제한 컬럼을 리턴.
```
![image](https://github.com/user-attachments/assets/14525cb4-9784-4ff7-9e5d-d1a807a31eb2)

```python
movies
```
![image](https://github.com/user-attachments/assets/08c2a05e-4b33-419b-8936-c71eedd653af)

```python
movies_explode = movies.explode('genre')
# pd.DataFrame.explode(column): column의 값들을 하나씩 row(행)으로 만듦.
```
```python
movies_explode
```
![image](https://github.com/user-attachments/assets/d0dcb217-368b-4d64-a6bb-775f22368b75)

```python
movies_explode[movies_explode.title.isin(female_top100)].genre.value_counts()
```
![image](https://github.com/user-attachments/assets/2eb45598-9135-431e-8198-907ba8ecd516)

### 남성 별점 평균 상위 100개 영화 장르

```python
# 남성 별점 평균 상위 100개의 영화 제목
male_top100 = by_title_gender.sort_values(by = 'M', ascending = False).head(n = 100).index
male_top100_movies = movies_explode[movies_explode.title.isin(male_top100)]
male_top100_movies.genre.value_counts()
```
![image](https://github.com/user-attachments/assets/3a8e53c6-1649-4041-927c-210f283be4d4)

```python
male_genres_10 = male_top100_movies.genre.value_counts().head(n = 10)
```
```python
sns.barplot(x = male_genres_10, y = male_genres_10.index)
plt.show()
```
![image](https://github.com/user-attachments/assets/6b30d82e-9916-40da-b4a6-143c21965ed0)

## 호불호(선호도) 차이가 큰 영화
* 120번 이상 별점 리뷰가 있는 영화들에서,
* 별점의 표준편차가 큰 순서
* 성별 별점의 표준편차가 큰 순서

### 별점 표준편차가 큰 영화들
```python
# 제목별 별점 표준편차
std_by_title = df_reduced.pivot_table(values = 'rating', index = 'title', aggfunc = 'std')

# df_reduced.groupby(by = ['title']).rating.std()
```
```python
# 제목별 별점 표준편차 내림차순 정렬 -> 상위 50개 영화 제목
std_title_50 = std_by_title.sort_values(by = 'rating', ascending = False).head(n = 50).index
std_title_50
```
![image](https://github.com/user-attachments/assets/3f79a03c-5536-4fc5-9924-86d6cf8a1d06)

```python
# 별점 표준편차가 큰 영화들의 장르
movies_explode[movies_explode.title.isin(std_title_50)].genre.value_counts()
```
![image](https://github.com/user-attachments/assets/50ba1948-258c-4661-ae76-89f5efb8675f)

### 성별 별점 표준편차가 큰 영화들

```python
std_by_title_gender = df_reduced.pivot_table(values = 'rating', index = 'title', columns = 'gender', aggfunc = 'std')
```
```python
std_female_title_50 = std_by_title_gender.sort_values(by = 'F', ascending = False).head(n = 50).index
```
```python
std_female_title_50
```
![image](https://github.com/user-attachments/assets/672240ce-38e3-4df8-ab84-d6ac98215f2a)

```python
movies_explode[movies_explode.title.isin(std_female_title_50)].genre.value_counts()
```
![image](https://github.com/user-attachments/assets/723bd168-35ce-4fed-bca7-febeb0018d66)

```python
# 제목별 남성 별점 표준편차 내림차순 정렬 -> 상위 50개 영화 제목
std_female_title_50 = std_by_title_gender.sort_values(by = 'M', ascending = False).head(n = 50).index
```
```python
std_female_title_50
```
![image](https://github.com/user-attachments/assets/bec563cb-1787-46e3-8c38-2f444ddfb72f)

```python
# 남성 별점 표준편차가 큰 영화 상위 50개 정보
movies_explode[movies_explode.title.isin(std_female_title_50)]
```
![image](https://github.com/user-attachments/assets/079f85c6-c2e5-4475-bd73-93a2a1082d7a)

# TODO
*  별점 평균이 4.5 이상인 영화들의 장르.
* 별점 평균이 4.0 이상인 영화들의 장르.
* 성별 별점 평균 4.0 이상인 영화들의 장르.
* 연령대별 별점 평균이 높은 순서로 정렬. 장르.
* 직업군별 별점 평균이 높은 순서로 정렬. 장르.

```python
df
```
![image](https://github.com/user-attachments/assets/db0e5fff-3f67-4577-ba65-464a70f5603f)

# 비지도 학습(Unsupervised Learning)

## Imports

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

from sklearn.cluster import KMeans
```

# Datasets

[Fruist 360](https://www.kaggle.com/datasets/moltean/fruits): 140, 340개의 과일/채소/견과류 이미지

```python
# 웹에 있는 파일 다운로드
# frurits.npy 저장할 파일 이름
!wget https://bit.ly/fruits_300 -O fruits.npy
```
<img width="895" height="324" alt="image" src="https://github.com/user-attachments/assets/a7f98139-f42c-4d75-aa17-4df8190c30f8" />

*   Jupyter 노트북에서 Linux 명령어를 실행할 때 `!`로 시작.
*   `wget URL주소 -O 파일이름`: URL주소의 파일을 다운로드 받아서 '파일이름'으로 저장.
*   확장자 npy 파일: numpy 배열을 저장한 바이너리 파일.

```python
fruits = np.load('fruits.npy') # npy 형식의 파일을 읽어서 numpy 배열을 만듦.
```
```python
fruits.shape  #> (300, 100, 100) -> (samples, width, height)
```
<img width="117" height="29" alt="image" src="https://github.com/user-attachments/assets/e9bb9ed5-63ae-47f0-bba3-9580d02ad608" />

```
100x100 크기의 흑백 이미지 300개를 numpy 배열로 저장한 데이터셋.
```

## 데이터 시각화

```python
plt.imshow(fruits[0], cmap = plt.cm.binary)  # plt.cm.binary -> plt.cm.gray는 배경이 검은색
plt.show()
```
<img width="395" height="377" alt="image" src="https://github.com/user-attachments/assets/6372db7e-a01c-4c47-949b-1edc6e459201" />

```python
plt.imshow(fruits[100], cmap = plt.cm.binary)
plt.show()
```
<img width="391" height="381" alt="image" src="https://github.com/user-attachments/assets/c5bb7017-077e-4738-bfba-d28fe354a450" />

```python
plt.imshow(fruits[200], cmap = plt.cm.binary)
plt.show()
```
<img width="387" height="380" alt="image" src="https://github.com/user-attachments/assets/23a2753a-382d-4e80-8fd4-d123e4aafb8c" />

```
numpy에는 레이블이 없음
```

```
첫 100개의 이미지를 10개 행, 10개 열로 배치해서 그려보세요.
```
```python
fig, ax = plt.subplots(nrows = 10, ncols = 10, figsize = (10, 10))

for row in range(10):
    for col in range(10):
        ax[row, col].imshow(fruits[row * 10 + col], cmap = plt.cm.binary)
        ax[row, col].axis('off')
plt.show()
```
<img width="610" height="594" alt="image" src="https://github.com/user-attachments/assets/047185f2-c779-4b1a-b349-e734b482c4df" />

```python
fig, ax = plt.subplots(nrows = 10, ncols = 10, figsize = (10, 10))

for row in range(10):
    for col in range(10):
        ax[row, col].imshow(fruits[100 + row * 10 + col], cmap = plt.cm.binary)
        ax[row, col].axis('off')
plt.show()
```
<img width="603" height="597" alt="image" src="https://github.com/user-attachments/assets/48e25b3d-4c0a-4811-9063-ed316e4c2bbe" />

```python
def plot_fruits(n_row = 10, n_col = 10, start = 0):
    fig, ax = plt.subplots(nrows = n_row, ncols = n_col, figsize = (10, 10))
    for row in range(10):
        for col in range(10):
            ax[row, col].imshow(fruits[start + row * 10 + col], cmap = plt.cm.binary)
            ax[row, col].axis('off')
    plt.show()
```
```python
plot_fruits()  # 기본값 사용
```
<img width="599" height="597" alt="image" src="https://github.com/user-attachments/assets/3a2825de-2983-4207-b552-e7519a4b07cf" />

```python
plot_fruits(start = 100)
```
<img width="613" height="598" alt="image" src="https://github.com/user-attachments/assets/c5379ffe-dc55-4fb2-bbe4-4761f1e79c49" />

```python
plot_fruits(start = 200)  # 200 ~ 299
```
<img width="608" height="595" alt="image" src="https://github.com/user-attachments/assets/a50ae917-b997-4e0d-9dc0-841e0b8351fd" />

# 이미지 Pixel 분석

```
(samples, width, height) shape의 3차원 배열을 (samples, width x height) shape의 2차원 배열로 변환
```
```python
fruits_2d = fruits.reshape((300, 100 * 100))  # 2차원 배열로 변환. 300개의 과일 이미지
# fruits_2d = fruits.reshape((300, -1))도 가능
```
```python
fruits_2d.shape
```
<img width="87" height="21" alt="image" src="https://github.com/user-attachments/assets/dd81ed73-70a6-4c37-b450-61c8fcc5074e" />

```python
apples = fruits_2d[:100]  # 사과 이미지
pineapples = fruits_2d[100:200]  # 파인애플 이미지
bananas = fruits_2d[200:]  # 바나나 이미지
```

## 각 샘플에서 모든 픽셀의 평균값

```python
apples.shape
```
<img width="84" height="26" alt="image" src="https://github.com/user-attachments/assets/2ca7cf27-6943-4073-a14b-baa2b4824c6a" />

```python
apple_means = apples.mean(axis = 1)
```
```python
print(apple_means)  # 총 100개. (0 ~ 255) 숫자가 클수록 진한 색
```
<img width="452" height="189" alt="image" src="https://github.com/user-attachments/assets/ed15f447-5692-43c0-ae76-9bec9f2c396d" />

```python
pineapple_means = pineapples.mean(axis = 1)
banana_means = bananas.mean(axis = 1)
```
```python
plt.hist(apple_means, alpha = 0.5, label = 'apple')
plt.hist(pineapple_means, alpha = 0.5, label = 'pineapple')
plt.hist(banana_means, alpha = 0.5, label = 'banana')

plt.legend()
plt.show()
```
<img width="437" height="343" alt="image" src="https://github.com/user-attachments/assets/9c36e5b9-a43f-4573-9070-aa5845134912" />

## 각 픽셀의 평균

<img width="334" height="296" alt="image" src="https://github.com/user-attachments/assets/eee83e06-b1a3-4070-8dca-5c525209c548" />

```
apples.mean(axis = 0) -> 이미지의 가로 방향 밝기 패턴을 보여줌
apples.mean(axis = 1) -> 이미지의 세로 방향 밝기 패턴을 보여줌
```
```python
apple_px_means = apples.mean(axis = 0)
pineapple_px_means = pineapples.mean(axis = 0)
banana_px_means = bananas.mean(axis = 0)
```
```python
print(apple_px_means.shape)
print(pineapple_px_means.shape)
print(banana_px_means.shape)
```
<img width="59" height="49" alt="image" src="https://github.com/user-attachments/assets/3386c215-1301-4f8a-aecd-83fdc88ccd43" />

```python
fig, ax = plt.subplots(nrows = 1, ncols = 3, figsize = (20, 4))
x = range(10_000)
ax[0].bar(x, apple_px_means)  # 막대그래프
ax[0].set_title('apple')

ax[1].bar(x, pineapple_px_means)    
ax[1].set_title('pineapple')

ax[2].bar(x, banana_px_means)    
ax[2].set_title('banana')

plt.show()
```
<img width="1213" height="286" alt="image" src="https://github.com/user-attachments/assets/33f197c0-18c0-4849-a756-05be762dfb1e" />

```
각 픽셀의 평균값(1차원 배열)을 100x100 이미지(2차원 배열)로 생각해서 시각화
```
```python
fig, ax = plt.subplots(nrows = 1, ncols = 3, figsize = (12, 4))
ax[0].imshow(apple_px_means.reshape((100, 100)), cmap = plt.cm.binary)
ax[0].set_title('apple')

ax[1].imshow(pineapple_px_means.reshape((100, 100)), cmap = plt.cm.binary)
ax[1].set_title('pineapple')

ax[2].imshow(banana_px_means.reshape((100, 100)), cmap = plt.cm.binary)
ax[2].set_title('banana')

plt.show()
```
<img width="801" height="272" alt="image" src="https://github.com/user-attachments/assets/2c6d8cfb-5476-47f2-96ff-150d52ff67e5" />

## 각 픽셀의 평균값들과 가까운 이미지 찾기

```python
fruits.shape
```
<img width="100" height="25" alt="image" src="https://github.com/user-attachments/assets/13489fac-c28b-4927-8694-230e7c7ed062" />

```python
apple_px_means. shape
```
<img width="60" height="28" alt="image" src="https://github.com/user-attachments/assets/ba10c961-e582-461f-a54a-ccc0c5b72421" />

```python
diff = np.abs(fruits - apple_px_means.reshape((100, 100)))  # 3차원, 2차원 배열
# 평균 사과 이미지와 모든 과일 이미지 간의 차이 계산
# np.abs는 절대값
# 이걸 통해 사과와 다른 과일들을 구분할 수 있음.
# diff 값이 작으면 원본 이미지가 사과일 가능성이 높음
```
```python
diff.shape
```
<img width="104" height="27" alt="image" src="https://github.com/user-attachments/assets/1fc5afbd-1bf9-46ef-bf19-4e2202a71cb7" />

<img width="432" height="63" alt="image" src="https://github.com/user-attachments/assets/1ceacf73-33ca-4606-932c-dd8a42ae858c" />

```python
diff_mean = np.mean(diff, axis = (1, 2))  # 300개 나옴
# 이미지의 전체 픽셀 차이의 평균값 계산
# axis = (1, 2)를 기준으로 평균을 계산하면, 이미지 하나당 평균 차이값 하나가 나옴
```
<img width="218" height="184" alt="image" src="https://github.com/user-attachments/assets/87d9c7f7-ba1f-49e0-b91a-74e69df12720" />

```python
diff_mean.shape
```
<img width="45" height="26" alt="image" src="https://github.com/user-attachments/assets/747a3c9c-796f-43f5-91cd-3f3a9f543904" />

```python
# 사과 픽셀 평균값과 차이가 작은 순서로 100개의 인덱스
apple_like_idx = np.argsort(diff_mean)[:100]    # np.argsort() 배열을 오름차순으로 정렬하고 인덱스 반환하는 함수
print(apple_like_idx)
```
<img width="526" height="92" alt="image" src="https://github.com/user-attachments/assets/2e48bafb-fa18-47d7-ab2d-b10724b33642" />



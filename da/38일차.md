# DataFrame에서 날짜/시간(datetime) 타입 데이터 다루기

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
```

# SPX 데이터셋
```python
file_path = 'https://github.com/wesm/pydata-book/raw/refs/heads/3rd-edition/examples/spx.csv'
spx = pd.read_csv(file_path)
spx.head()
```
![image](https://github.com/user-attachments/assets/214d8680-7d53-41cc-8c03-7b90ae145836)

```python
spx.tail()
```
![image](https://github.com/user-attachments/assets/17350cab-212f-4ddd-9ffa-95242058f26b)

```python
spx.info()
```
![image](https://github.com/user-attachments/assets/12c299c7-074a-433e-8530-ffff364dc5f7)

## 문자열 타입의 컬럼을 날짜/시간(datetime) 타입으로 변환
```python
spx['Date'] = pd.to_datetime(spx['Date'])  # pd.to_datetime(spx['Date'], format = '%Y-%m-%d %H:%M:$S')
```
```python
spx.info()
```
![image](https://github.com/user-attachments/assets/32636054-6104-4bc8-a85e-2d99e1f074ad)

```python
spx.head()
```
![image](https://github.com/user-attachments/assets/dbeb18f5-969c-443d-a8c9-480590c8912e)

## CSV 파일에서 DateFrame을 생성할 때 날짜/시간 컬럼을 지정.
```python
# spx = pd.read_csv(file_path, parse_dates = ['Date'])
# spx = pd.read_csv(file_path, parse_dates = ['Date'], date_format = '%Y-%m-%d %H:%M:$S')
spx = pd.read_csv(file_path, parse_dates = ['Date'],
                  date_format = {'Date': '%Y-%m-%d %H:%M:$S'})
```
```python
spx.info()
```
![image](https://github.com/user-attachments/assets/87d4ce65-f47d-4a8e-8418-e86c829bc7e6)

```python
spx.head()
```
![image](https://github.com/user-attachments/assets/f801a95f-001c-4ee6-ab4b-acc7a0d7755d)

## 기간별(연도별/분기별/월별) 통계

```python
# Date 컬럼 -> index(row label)로 변환
spx_with_index = spx.set_index('Date')
```
```python
spx_with_index.info()  
```
![image](https://github.com/user-attachments/assets/4c3085c4-0235-46ea-8f68-247d9662c479)

```python
spx_with_index.head()  # DatetimeIndex를 갖는 DateFrame
```
![image](https://github.com/user-attachments/assets/021ab22f-bbb6-46e9-bbe4-27a008efcfcb)

```python
# 연도별 SPX의 평균
by_year = spx_with_index.resample('Y').mean()
by_year.head()
```
![image](https://github.com/user-attachments/assets/2910a0c9-666a-4c8c-aa6a-1c301a0c2423)

```python
by_year.tail()
```
![image](https://github.com/user-attachments/assets/f7b7587f-31c3-4bcb-a7e1-7f98b2fd2019)

```python
sns.lineplot(data = by_year)
plt.grid()
plt.show()
```
![image](https://github.com/user-attachments/assets/56aa15bc-cb3e-465f-8551-74f6c3796377)

```python
# 분기별 SPX의 평균
by_quarter = spx_with_index.resample('Q').mean()
by_quarter.head()
```
![image](https://github.com/user-attachments/assets/3d2a18a8-6661-44d6-bbbb-f32449afc698)

```python
by_quarter.tail()
```
![image](https://github.com/user-attachments/assets/622be8c5-5ba4-465e-9ad1-88e79b4ed62c)

```python
fig = plt.figure(figsize = (16, 4))
sns.lineplot(data = by_quarter, marker = 'o')
plt.grid()
plt.show()
```
![image](https://github.com/user-attachments/assets/22566500-fecd-4c4c-83ee-1209e9d18106)

```python
# 월별 SPX 평균
by_month = spx_with_index,resample('M').mean()
```
```python
by_month.head()
```
![image](https://github.com/user-attachments/assets/25939a2e-0dc2-4094-8178-3987ff565c0c)

```python
fig = sns.figure(figsize = (16, 4))
sns.lineplot(data = by_month)
plt.grid()
plt.show()
```
![image](https://github.com/user-attachments/assets/f8d4a092-fe49-4d02-9951-561dcfa0c1cc)

```python
# pd.read_csv() 함수 index_col 파라미터: 컬럼을 인덱스로 설정
spx = pd.read_csv(file_path, parse_dates = ['Date'], index_col = ['Date'])
```
```python
spx.head()
```
![image](https://github.com/user-attachments/assets/2b430493-d602-48d3-b75a-41913f9bdb7b)

```python
spx.info()
```
![image](https://github.com/user-attachments/assets/4be26d47-7691-4ff3-967a-bd2fa331898e)

# banklist 데이터셋

*   [banklist.csv](https://github.com/JakeOh/202505_BD50/raw/refs/heads/main/datasets/banklist.csv)
*   데이터프레임을 생성할 때 날짜/시간(datetime) 타입으로 변환할 수 있는 모든 컬럼들은 날짜/시간 타입으로 변환
*   연도별 파산한 은행 숫자 시각화
*   분기별 파산한 은행 숫자 시각화
*   월별 파산한 은행 숫자 시각화
*   기간별 통계는 Closing Date를 기준으로.

```python
file_path = 'https://github.com/JakeOh/202505_BD50/raw/refs/heads/main/datasets/banklist.csv'
```
```python
banklist = pd.read_csv(file_path, parse_dates = ['Closing Date', 'Updated Date'],
                       index_col = ['Closing Date'])
```
```python
banklist.head()
```
![image](https://github.com/user-attachments/assets/aeee3edc-9cb6-43fb-9232-54f6c71ce44e)

```python
# 폐쇄된 은행 이름, 폐쇄된 은행의 도시, 폐쇄된 은행이 위치한 주, 은행 인증 번호, 은행을 인수한 회사, 은행이 문닫은 날짜, 최종적으로 업데이트 된 날짜
```
```python
banklist.info()
```
![image](https://github.com/user-attachments/assets/da29883b-6ed0-4a7b-aa57-ab1df181d84f)

```python
banklist['Updated Date'].describe()
```
![image](https://github.com/user-attachments/assets/e0ebad97-3934-42fa-833f-cd6c9a6bd2e0)

# 기간별 resampling

```python
def lineplot_resample(rule):
    df = banklist.resample(rule).size()
    # print(df)
    fig = plt.figure(figsize = (20, 4))
    sns.lineplot(data = df)
    plt.grid()
    plt.show()
```
```python
lineplot_resample('Y')
```
![image](https://github.com/user-attachments/assets/3924fcb4-932f-4534-94a1-debca380f5eb)

```python
lineplot_resample('Q')
```
![image](https://github.com/user-attachments/assets/9c9d286d-4d12-4912-8ad7-8409acc921a8)

```python
lineplot_resample('M')
```
![image](https://github.com/user-attachments/assets/541eb34d-35e4-4d68-ab45-0845df564511)


# Categorical Date

```python
import numpy as np
import pandas as pd
```
```python
df = pd.DataFrame(data = {
    'user_id': np.arange(1, 11),
    'gender': ['M'] * 5 + ['F'] * 5,
    'score': np.random.randint(1, 6, size = 10)
})
```
```python
df
```
![image](https://github.com/user-attachments/assets/a97512ec-139b-4166-95ee-e93368ade1c5)

```python
df.info()
```
![image](https://github.com/user-attachments/assets/ae20e530-458a-4edb-8f35-81e45bfb8466)

```python
df.gender.value_counts()
```
![image](https://github.com/user-attachments/assets/651eebbb-d1e3-4847-ab03-89181d9d4787)

```python
df.score.value_counts()
```
![image](https://github.com/user-attachments/assets/35ac91c9-4d36-4a53-a7ac-c3f3f25483af)

```python
df.gender = df.gender.astype('category')
df.score = df.score.astype('category')
df.info()
```
![image](https://github.com/user-attachments/assets/273af6ec-a0cc-4e00-b32b-c0ebdbb9a8c2)

```python
df.gender.cat.categories
```
![image](https://github.com/user-attachments/assets/746428c0-4699-4759-9067-53a7af697821)

```python
df.score.cat.categories
```
![image](https://github.com/user-attachments/assets/cc418f30-27fc-48af-8763-758d978f2dcf)

```python
df.score = df.score.cat.add_categories(6)
df.score.cat.categories
```
![image](https://github.com/user-attachments/assets/e73e1116-91df-4898-b087-b917a376b159)

# 연속형 변수에서 파생된 카테고리 변수 만들기

```python
df = pd.DateFrame(data = {
    'id': np.arange(1, 11),
    'age': np.random.randint(0, 100, size = 10)
})
```
```python
df
```
![image](https://github.com/user-attachments/assets/4a1099a3-21a9-44ed-b5d6-1f5cb98b8de5)

```python
df['age_range'] = pd.cut(x = df.age, bins = np.arange(0, 100, 10), right = False)
df
```
![image](https://github.com/user-attachments/assets/5295f1b1-23a5-4082-8ebc-3a66f38a4256)

```python
df.info()
```
![image](https://github.com/user-attachments/assets/925da675-fe43-441c-b16c-01a72005f0c5)

```python
df.age_range.cat.categories
```
![image](https://github.com/user-attachments/assets/d0b70d8a-3835-4ea7-9fac-dd9a490f152e)

```python
df['age_cat'] = pd.cut(x = df.age, bins = [0, 18, 40, 60, 100], right = False,
                        labels = ['미성년', '청년', '중년', '노년'])  # 오른쪽 포함 안함
df
```
![image](https://github.com/user-attachments/assets/a624d4d2-cbae-4ada-8334-18caa14d6176)

```python
df.age_cat.cat.categories
```
![image](https://github.com/user-attachments/assets/27510768-c379-4b94-96f1-9ff1377706c8)


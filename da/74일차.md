# 합성곱 시각화


scikit-learn 데이터셋에서 제공되는 예제 이미지 파일의 합성곱 연산 결과를 시각화


```python
import tensorflow as tf
from sklearn.datasets import load_sample_images     # 이미지 두개를 가져올 수 있음
```
```python
sample_images = load_sample_images()
```
```python
type(sample_images)    # Bunch: Python dict와 비슷한 객체. key-value를 갖는 객체.
```
<img width="733" height="400" alt="image" src="https://github.com/user-attachments/assets/3f9dcd9b-2c21-42d6-8622-5797aa049853" />

```python
sample_images.keys()
```
<img width="316" height="31" alt="image" src="https://github.com/user-attachments/assets/fd916da5-e3e7-4c3d-8963-a02653256347" />

```python
print(sample_images.DESCR)
```
<img width="608" height="313" alt="image" src="https://github.com/user-attachments/assets/0ac6c898-4e3f-483c-ac44-7bf5ff4fe6a1" />

```python
images = sample_images.images
# (427, 640, 3) shape의 np.ndarray 2개를 원소로 갖는 리스트(list)
```
```python
fig, ax = plt.subplots(ncols = 2, figsize = (12, 8))  # 가로 세로
for i in range(2):
    ax[i].imshow(images[i])
plt.show()
```
<img width="986" height="330" alt="image" src="https://github.com/user-attachments/assets/f2a2705b-cb00-42ae-9911-b8d6e95b77c8" />

```python
images[0]   # 0 ~ 255까지의 숫자들로 이루어짐
```
<img width="585" height="407" alt="image" src="https://github.com/user-attachments/assets/83ab02f1-c1bc-4312-929e-fd78ae997474" />

```python
# 이미지 자르기 - 이미지의 가운데에서 70x120 크기로 자르기.
images_crop = keras.layers.CenterCrop(height = 70, width = 120)(images)
images_crop.shape
```
<img width="210" height="31" alt="image" src="https://github.com/user-attachments/assets/f1af5996-0436-49cb-a646-dbf49c3db556" />

```python
# 이미지 스케일링 - 모든 픽셀의 값을 0 ~ 1 사이의 범위로 스케일링.
# 픽셀의 값만 바뀌고, 모양은 그대로
images_scaled = keras.layers.Recaling(scale = 1./255)(images_crop)
images_scaled.shape
```
<img width="204" height="30" alt="image" src="https://github.com/user-attachments/assets/68a57ed4-ff6a-4081-975b-193940fd10a1" />

```python
fig, ax = plt.subplots(nrows = 2, figsize = (4, 6))
for i in range(2):
    ax[i].imshow(images_scaled[i])
plt.show()
```
<img width="357" height="480" alt="image" src="https://github.com/user-attachments/assets/e0734e77-4921-4b8f-bcdc-d91c1f8af1eb" />


<img width="697" height="380" alt="image" src="https://github.com/user-attachments/assets/21501d5e-04cb-48e0-8c6e-6cabd0ad02b9" />

```
두개의 필터를 쓸거니깐 한 이미지에 2개의 이미지가 나옴
총 4개가 나오는거
```
```python
# (7, 7, 3) 모양의 필터 2개를 갖는 배열
# 0으로만 채워져있음
filters = np.zeros(shape = (7, 7, 3, 2))    # (7x7), 입력 이미지의 채널 수 3, 생성할 필터의 개수 2
filters[:, 3, :, 0] = 1  # 수직 방향의 값들만 합성곱이 되도록 만든 필터.
filters[3, :, :, 1] = 1  # 수평 방향의 값들만 합성곱이 되도록 만든 필터.
```
<img width="344" height="155" alt="image" src="https://github.com/user-attachments/assets/2eb5b1de-d677-46e9-a1ba-c07c292049a5" />

```python
# 2-D 합성곱 연산 수행
feature_maps = tf.nn.conv2d(input = images_scaled, filters = filters,
                            strides = 1, padding = 'SAME')    # padding = 'SAME' -> 이미지의 크기 그대로 나오도록
feature_maps.shape
# 2 -> 이미지 갯수
# 70, 120 -> 이미지 세로, 가로
# 2 -> filter 2개. output의 갯수
```
<img width="210" height="25" alt="image" src="https://github.com/user-attachments/assets/80de9f6b-04cf-4da1-9c03-a440e7cc37d6" />

```python
# 합성곱 필터가 실제로 어떤 특징을 추출하는지 눈으로 확인하기 위해서
fig, ax = plt.subplots(nrows = 2, ncols = 2, figsize = (12, 7))

for i in range(2):
    for j in range(2):
        ax[i, j].imshow(feature_maps[i, :, :, j])
plt.show()
```
<img width="974" height="586" alt="image" src="https://github.com/user-attachments/assets/8b886f13-accd-4ebb-82df-1bd165fd33f5" />

# 파이썬 클래스 `__call__` magic 메서드. 함수형 API.


클래스의 인스턴스를 함수처럼 사용할 수 있도록 만들어 주는 메서드. 클래스의 객체가 함수와 유사한 동작을 할 수 있도록 기능을 제공.


```python
class Test:
    def __init__(self, value = 0):
        self.value = value  # 객체의 프로퍼티를 초기화.

    def __str__(self):
        return f'Test 객체(value = {self.value})'

    def __repr__(self):
        return f'Test [ value = {self.value} ]'

```

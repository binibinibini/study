# company 이름의 오타 수정

```python
mpg.loc[mpg.company == 'chevroelt', 'company'] = 'chevrolet'    # 'chevroelt'이름을 가진 행에서 company 컬럼을 chevrolet로 변경
mpg.loc[mpg.company == 'maxda', 'company'] = 'mazda'
mpg.loc[mpg.company == 'mercedes', 'company'] = 'mercedes-benz'
mpg.loc[mpg.company == 'toyouta', 'company'] = 'toyota'
mpg.loc[mpg.company == 'vokswagen', 'company'] = 'volkswagen'
```
```python
companies = mpg.company.unique()
companies.sort()
companies
```
![image](https://github.com/user-attachments/assets/d53295bb-80d4-453b-8809-13b9bdbbe45e)

```python
companies.size
```
![image](https://github.com/user-attachments/assets/e9b0558a-3075-4c40-80da-20936b9b3b81)

# movies 데이터셋

```python
movies_file = 'https://github.com/wesm/pydata-book/raw/refs/heads/3rd-edition/datasets/movielens/movies.dat'
```

```python
# movies.dat 파일은 값들이 '::'로 구분된 텍스트 파일.
movies = pd.read_csv(movies_file,
                     sep = '::',                                 # 구분자
                     names = ['movie_id', 'title', 'genres'],    # 컬럼 이름
                     engine = 'python')                          # sep = '::' 때문에 발생하는 경고(warning)를 없애기 위해서
```

```python
movies.head()
```
![image](https://github.com/user-attachments/assets/265a678c-1c53-470c-a644-fdf043821169)

```python
movies.tail()
```
![image](https://github.com/user-attachments/assets/77fa3047-836a-414b-8708-2a4b5bda2666)

```python
movies.info()
```
![image](https://github.com/user-attachments/assets/589751dc-fc7e-42d1-a966-44f5852c6002)

* 장르 분석
    * 장르가 Animation인 영화는 몇 개?
    * 가장 많이 등장하는 장르 이름?
* 개봉 연도 분석
    * 연도별 개봉 영화 숫자

## 장르가 Animation인 영화
```python
animations = movies[movies.genres.str.contains('Animation')]
```
```python
animations.head()
```
![image](https://github.com/user-attachments/assets/44ff1f4d-ed81-46e9-a9d4-5aa33cef390e)

```python
animations.tail()
```
![image](https://github.com/user-attachments/assets/31f6ec1d-3da9-4b0e-8767-d909360e9603)

```python
animations.info()
```
![image](https://github.com/user-attachments/assets/b747c548-188f-4792-95be-b1d41b707d9f)

```python
animations.size  # 행(row)의 개수 x 열(column)의 개수
```
![image](https://github.com/user-attachments/assets/1b2780e1-c7f5-492d-b2f8-8e631b2382be)

```python
len(animations)
```
![image](https://github.com/user-attachments/assets/5b17763d-efc2-4361-96cb-fa360b87a5f6)

## 장르가 Drama인 영화

```python
dramas = movies[movies.genres.str.contains('Drama')]
dramas.head()
```
![image](https://github.com/user-attachments/assets/a33cfa39-9c79-4883-b42d-40a63ccfd0be)

```python
len(dramas)
```
![image](https://github.com/user-attachments/assets/849799f2-d56d-47a2-975a-1fd810dba3a5)

# 장르가 로맨틱 코미디(Romance & Comedy)인 영화

```python
romanticd_comedies = movies[movies.genres.str.contains('Romance') &
                      movies.genres.str.contains('Comedy')]
romantic_comedies.head()
```
![image](https://github.com/user-attachments/assets/6621ed62-7ce8-454a-ade1-c2895edd9f89)

```python
len(romanticd_comedies)
```
![image](https://github.com/user-attachments/assets/bdacb942-8eea-4329-bc4b-def1fa32ef85)

## 가장 많이 등장하는 영화 장르 상위 10개

```python
genres = []    # 장르들을 저장하기 위한 빈 리스트

for x in movies.genres:
    genres.extend(x.split(sep = '|'))  # extend는 1차원 배열로 저장
```

- append()는 리스트 통째로 넣고, extend()는 요소 하나씩 풀어서 넣음

```python
print(genres)
```
![image](https://github.com/user-attachments/assets/3cc6f1de-a2bf-4cc8-b626-30efb7542247)

```python
pd.value_counts(genres)
```
![image](https://github.com/user-attachments/assets/e4088933-2603-4d3e-8f17-ef9035d45a47)

```python
genres_series = pd.Series(genres)    # list -> pd.Series 타입으로 변환
print(genres_series)
```
![image](https://github.com/user-attachments/assets/2c949d87-af0c-498e-88a3-9ca332c14ab8)

```python
genre_count = genres_series.value_counts()    # 내림차순으로 결과를 보여줌
genre_count
```
![image](https://github.com/user-attachments/assets/fbe35d00-7b61-41d3-a822-4658d0a1ab7b)

```python
top10_genre = genre_count.head(n = 10)
top10_genre
```
![image](https://github.com/user-attachments/assets/94320015-c182-4b6f-9bd0-e1a70575efb7)

```python
# sns.barplot(data = top10_genre)   # 세로 막대 그래프
sns.barplot(x = top10_genre, y = top10_genre.index)
plt.show()
```
![image](https://github.com/user-attachments/assets/b38cb832-5552-40c2-aaef-d4707b6494b0)

## 영화 장르 하위 10개
<br>

링크 텍스트 등장하는 영화 장르 하위 10개

```python
low10_genre = genre_count.tail(n = 10)
low10_genre
```
![image](https://github.com/user-attachments/assets/ebe31467-778d-48be-b313-7ad36f4944f6)

```python
sns.barplot(x = low10_genre, y = low10_genre.index)
plt.show()
```
![image](https://github.com/user-attachments/assets/f5873736-cd7b-441f-98a4-ea223cef9057)

## 영화 개봉 연도 분석

- 영화 제목(title)에서 영화 개봉 연도를 찾아서 파생 변수(year) 생성 <br>
- 연도별 개봉 영화 수 <br>
- 그래프 시각화 <br>

```python
movies.head()
```
![image](https://github.com/user-attachments/assets/2ca0f845-58cf-4b6f-810d-29d9067569dd)

```python
movies['year'] = movies.title.str[-5:-1].astype('int')
```

```python
movies.head()
```
![image](https://github.com/user-attachments/assets/52456d95-ef88-4cec-94e1-f5fb354ada5c)

```python
movies.info()
```
![image](https://github.com/user-attachments/assets/7123beef-9cae-4f1f-a281-99539dfda930)

```python
year_count = movies.year.value_counts()
year_Count
```
![image](https://github.com/user-attachments/assets/5098a43e-f157-431f-b9bc-31a897a69633)

```python
sns.barplot(data = year_count)
plt.show()
```
![image](https://github.com/user-attachments/assets/7edce3ba-a956-4fa7-a9c2-ebc941e44d22)

```python
sns.lineplot(data = year_count)
plt.show()
```
![image](https://github.com/user-attachments/assets/22198581-d67e-419b-9c32-6a24def6741e)


# DataFrame 합치기

- merge: 두 개 이상의 데이터프레임을 공통된 컬럼(들)을 기준으로 합치는 것. SQL의 join과 비슷.
- concat: 두 개 이상의 데이터프레임을 축(axis)을 따라서 합치는 것.

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
```

# merge

```python
emp = pd.DataFrame(data = {
    'empno': [100, 101, 200, 201],
    'ename': ['Scott', 'Tiger', 'King', '오쌤'],
    'deptno': [10, 20, 10, 50]
})
emp
```
![image](https://github.com/user-attachments/assets/6a1f443a-7d75-4bf4-bec9-d93394aaaa2b)

```python
dept = pd.DataFrame(data = {
    'deptno': [10, 20, 30],
    'dname': ['HR', 'IT', 'Sales']
})
dept
```
![image](https://github.com/user-attachments/assets/2d1b7a87-a914-4ea7-872f-b3b6285b2145)

<br>

- pd.merge(left, right, how, on, ...) 함수<br>
- pd.DataFrame.merge(right, how, on, ...) 메서드<br>
- 파라미터 how: merge 방식(inner, left, right, outer). 기본값은 'inner'.<br>
- 파라미터 on: join의 기준이 되는 컬럼(들의 리스트). join 컬럼 이름이 같은 경우에는 생략 가능.<br>


## inner join

```python
pd.merge(emp, dept)
```
![image](https://github.com/user-attachments/assets/5c8f12f3-bc90-4f26-bb91-f420c41bbdc6)

```python
emp.merge(dept)
```
![image](https://github.com/user-attachments/assets/19a41855-e293-4187-a3e6-62b2431183dd)

## left(outer) join

```python
pd.merge(emp, dept, how = 'left')
```
![image](https://github.com/user-attachments/assets/40c177fd-f3da-44a6-b5ec-e488f8e8cf59)

```python
emp.merge(dept, how = 'left')
```
![image](https://github.com/user-attachments/assets/c11369db-1ea5-45f5-b0e6-ad6bb12f1f53)

## right (outer) join
```python
pd.merge(emp, dept, how = 'right')
```
![image](https://github.com/user-attachments/assets/383b8186-262f-4dff-b263-90b96530430a)

```python
emp.merge(dept, how = 'right')
```

![image](https://github.com/user-attachments/assets/0ff9a6e1-8cd4-4f9e-a4d4-c642c58459d6)

## full (outer) join

```python
emp.merge(dept, how = 'outer')
```
![image](https://github.com/user-attachments/assets/42f422a2-54a8-4115-9598-e9a6c19e35f6)

## join 기준 컬럼 이름이 다른 경우

```python
emp
```
![image](https://github.com/user-attachments/assets/887800cf-3943-4945-9041-3ba8f18a0e43)

```python
dept2 = pd.DataFrame(data = {
      'dno': [10, 20, 30],
      'dname': ['인사', '아이티', '영업']
})
dept2
```
![image](https://github.com/user-attachments/assets/46825d8e-f145-46b7-b29b-2ec1cd13d6a7)

```python
# inner join
pd.merge(emp, dept2, left_on = 'deptno', right_on = 'dno')
```
![image](https://github.com/user-attachments/assets/084448d2-e0c4-4e06-a7dc-dc0971ed885f)

```python
# left (outer) join
pd.merge(emp, dept2, how = 'left', left_on = 'deptno', right_on = 'dno')
```
![image](https://github.com/user-attachments/assets/bb450359-321a-409c-8939-6643ba4b1d53)

```python
# right (outer) join
pd.merge(emp, dept2, how = 'right', left_on = 'deptno', right_on = 'dno')
```
![image](https://github.com/user-attachments/assets/a6dc0849-3a34-4d00-bf34-e66ec5092134)

```python
# full (outer) join
pd.merge(emp, dept2, how = 'outer', left_on = 'deptno', right_on = 'dno')
```
![image](https://github.com/user-attachments/assets/aff3dbb8-3182-49ad-8003-d876790a5005)

## 인덱스(row label)로 merge하기.

```python
np.random.seed(1)
```
```python
df1 = pd.DataFrame(data={
    'value1': np.random.randint(100, size = 6),
    'value2': ['a', 'b', 'c'] * 2
})
df1
```
![image](https://github.com/user-attachments/assets/f0b40f8b-d4f8-4bc8-984f-6f415c7d4fce)

```python
df2 = pd.DataFrame(data={'value3': np.arange(10, 40, 10)},
                   index=['a', 'b', 'c'])
df2
```
![image](https://github.com/user-attachments/assets/6d03e0d3-94b5-49bb-a8b9-f16b5518ecee)

```python
# df1과 df2를 merge
df1.merge(df2, left_on = 'value2', right_index = True)
```
![image](https://github.com/user-attachments/assets/b04691b1-61a5-41f7-8d75-8ba936ea1d27)

# concat

## Series에서의 concat

```python
s1 = pd.Seried(data = ['scott', 'allen', 'king'])
s1
```
![image](https://github.com/user-attachments/assets/bb06cf96-d749-4568-b885-f260d698b5df)

```python
s2 = pd.Series(data = ['오쌤', '홍길동'])
s2
```
![image](https://github.com/user-attachments/assets/87e1e0e9-bd65-4064-9cce-fd1488e0f50b)

```python
pd.concat([s1, s2])
```
![image](https://github.com/user-attachments/assets/d412d9ec-bb9d-4fe5-9505-0158b470f326)

```python
pd.concat([s1, s2], ignore_index = True)  # 인덱스 무시
```
![image](https://github.com/user-attachments/assets/5d2548e6-376e-45df-8513-c80e88be1dd0)

```python
s3 = pd.Series(data = ['HR', 'IT'])
s3
```
![image](https://github.com/user-attachments/assets/4d837d3d-36d8-4d0a-88d5-031965ef1dfd)

```python
pd.concat([s1, s3], axis = 1)
```
![image](https://github.com/user-attachments/assets/b03c4e2f-11fc-4659-9d51-88e2f9b51923)

## DataFrame에서의 concat

```python
np.random.seed(1)
day1_df = pd.DataFrame(data = np.random.randint(100, size = (5, 3)),
                       columns = ['A', 'B', 'C'])
day1_df
```
![image](https://github.com/user-attachments/assets/5b4faf28-1250-457c-906c-f255089ecc3e)

```python
day2_df = pd.DataFrame(data = np.random.randint(100, size = (5, 3)),
                       columns = ['A', 'B', 'C'])
day2_df
```
![image](https://github.com/user-attachments/assets/1ea19848-eaba-40d7-8e68-336a15c8f126)

```python
pd.concat([day1_df, day2_df], ignore_index = True)  # axis = 0 기본값이기 때문에 생략.
```
![image](https://github.com/user-attachments/assets/c70a98cc-39b4-4ebe-a1ba-0addb05abf21)

```python
df = pd.DataFrame(data = np.random.rand(5, 3),
                columns = ['d', 'e', 'f'])
df
```
![image](https://github.com/user-attachments/assets/7d3455ff-9273-43d7-8d05-65ffeb0c5d9f)

```python
pd.concat([day1_df, df], axis = 1)
```
![image](https://github.com/user-attachments/assets/4735d3d0-929b-42c0-bf1f-fc42fc7bd46d)

# merge, concat 연습 1

- https://github.com/pandas-dev/pandas/tree/main/doc/data 데이터 사용<br>
- air_quality_no2_long.csv, air_quality_pm25_long.csv, air_quality_stations.csv 파일을 읽고, 각각 데이터프레임을 생성.<br>
- air_quality_no2와 air_aulity_pm25 데이터프레임을 합치세요.<br>
- 위에서 만들어진 데이터프레임과 air_quality_stations 데이터프레임을 합치세요.<br>

```python
# 파일 경로
no2_file = 'https://github.com/pandas-dev/pandas/raw/refs/heads/main/doc/data/air_quality_no2_long.csv'
pm25_file = 'https://github.com/pandas-dev/pandas/raw/refs/heads/main/doc/data/air_quality_pm25_long.csv'
stations_file = 'https://github.com/pandas-dev/pandas/raw/refs/heads/main/doc/data/air_quality_stations.csv'
```

## air_quality_no2 데이터프레임
```python
no2_df = pd.read_csv(no2_file)
```
```python
no2_df.head()
```
![image](https://github.com/user-attachments/assets/d8b6c46c-9fbe-4c99-ba59-292db1607579)

```python
no2_df.tail()
```
![image](https://github.com/user-attachments/assets/a65aa0d3-47fd-4c1b-af2f-51e79ae1df8e)

```python
no2_df.info()
```
![image](https://github.com/user-attachments/assets/a70ee985-6fa1-401c-bb2d-59ae6890198d)

```python
no2_df.city.unique()
```
![image](https://github.com/user-attachments/assets/c3a47a8b-f1bb-4558-808d-d4ef2bca5f71)

```python
no2_df.country.unique()
```
![image](https://github.com/user-attachments/assets/825483f6-0d7b-4c0d-9b9f-34e7e14ef84b)

```python
no2_df.location.unique()
```
![image](https://github.com/user-attachments/assets/8b4cd5eb-859c-44ac-a8dc-ad8265826299)

```python
no2_df.parameter.unique()
```
![image](https://github.com/user-attachments/assets/7eee98ff-bc6d-4d99-a31f-a01e2fb2fb01)

```python
no2_df.value.describe()
```
![image](https://github.com/user-attachments/assets/88f07458-a667-4827-b281-154bb4e7f158)

## air_quality_pm25 데이터프레임

```python
pm25_df = pd.read_csv(pm25_filt)
```
```python
pm25_df.head()
```
![image](https://github.com/user-attachments/assets/2a28ddd1-2901-464a-8a0f-6a036c88be26)

```python
pm25_df.tail()
```
![image](https://github.com/user-attachments/assets/83ca5aaa-8997-4c47-bf6f-92be0451d594)

```python
pm25_df.info()
```
![image](https://github.com/user-attachments/assets/fa64286d-a1dc-4a23-8cb2-6200fb89534d)

```python
pm25_df.city.unique()
```
![image](https://github.com/user-attachments/assets/5cf2b53a-aa83-4db9-bec4-b851f8923aaf)

## air_quality_stations 데이터프레임

```python
stations_df = df.read_csv(stations_file)
```
```python
station_df.head()
```
![image](https://github.com/user-attachments/assets/85ccd329-da25-4579-bad7-91616b14c337)

```python
stations_df.tail()
```
![image](https://github.com/user-attachments/assets/bf9ddb53-6c66-4b7b-a2fb-37717a534ee9)

```python
stations_df.info()
```
![image](https://github.com/user-attachments/assets/4e28defc-c398-48a7-98f4-8ac19de5ccf8)

```python
stations_df[stations_df.location.isin(['FR04014', 'BETR801', 'London Westminster'])]
```
![image](https://github.com/user-attachments/assets/ed3db60f-6c1e-4ce9-815b-cf4181144c51)

```python
stations_df_new = stations_df.drop(labels = 27)  # 행 인덱스 27번을 삭제
```
```python
stations_df_new[stations_df_new.location.isin(['FR04014', 'BETR801', 'London Westminster'])]
```
![image](https://github.com/user-attachments/assets/7dbc9454-d0b0-4ec5-85c0-a378f98292a9)

## no2와 pm25 데이터프레임 concat

```python
air_quality = pd.concat([no2_df, pm25_df])
```
```python
air_quality.head()
```
![image](https://github.com/user-attachments/assets/63a4b812-4c1c-4719-be5c-8a5bad840141)

```python
air_quality.tail()
```
![image](https://github.com/user-attachments/assets/f6163836-e04f-490b-9dcc-f2eb3df7b637)

```python
air_quality.info()
```
![image](https://github.com/user-attachments/assets/b0154bf3-f38c-41a8-8a72-5be0768346e1)

```python
air_quality.city.unique()
```
![image](https://github.com/user-attachments/assets/b547dc79-5776-4ef4-b66c-72203653915b)

```python
air_quality.country.unique()
```
![image](https://github.com/user-attachments/assets/81157245-d2c6-491b-ae8e-8ecf31e4e3a4)

```python
air_quality.location.unique()
```
![image](https://github.com/user-attachments/assets/e34a6f53-47b6-4516-b57d-62f4df056270)

## air_quality, locations_df_new 데이터프레임 merge

```python
air_quality = pd.merge(air_quality, stations_df_new)
```
```python
air_quality.head()
```
![image](https://github.com/user-attachments/assets/3f3a126c-d938-441e-a7d1-eb302f80e4c6)

```python
air_quality.info()
```
![image](https://github.com/user-attachments/assets/8e6a459e-230a-4594-b942-dc6e42293650)

```python
air_quality['data.utc'] = pd.to_datetime(air_quality['date.utc'], utc = True)
```
```python
air_quality.info()
```
![image](https://github.com/user-attachments/assets/93290c29-cfbf-4110-8c37-45cc40a01ea1)

```python
air_quality.head()
```
![image](https://github.com/user-attachments/assets/ff635028-ecd1-4f05-a01b-b12cae3819c8)

## London의 NO2, PM25 농도 시계열 그래프

```python
london_df = air_quality[air_quality.city == 'London']

london_df.head()
```
![image](https://github.com/user-attachments/assets/fa931022-5d2a-42a0-80bd-190e2bb1b1a7)

```python
london_df.tail()
```
![image](https://github.com/user-attachments/assets/5a07b239-4e30-485e-90d3-e67ae2879198)

```python
fig = plt.figure(figsize = (16, 4))
sns.lineplot(data = london_df, x = 'date.utc', y = 'value', hue = 'parameter')
plt.show()
```
![image](https://github.com/user-attachments/assets/be0086c2-80eb-403e-973f-d5d5c45c247d)
